!function(){var e=function(e){var i;switch(e){case"se":i={OPEN_PICKER_SINGLE:"Välj vecka...",OPEN_PICKER:"Välj veckor...",CLEAR:"Rensa",NUM_SELECTED:"$num_selected veckor valda",WEEK_SELECTED:"Vecka $weeknum"};break;case"en":default:i={OPEN_PICKER_SINGLE:"Choose a week...",OPEN_PICKER:"Open picker...",CLEAR:"Clear",NUM_SELECTED:"$num_selected weeks selected",WEEK_SELECTED:"Week $weeknum"}}return i};if(!window.moment)throw new Error("moment.js not found; required");if(!window.jQuery)throw new Error("jQuery not found; required");var i=window.jQuery,a=window.moment;i.fn.weekPicker=function(t){var r=this,c=arguments,n={init:function(){var t=i(this),r=this;t.empty();var c=this.weekPicker.mode=t.data("mode")||"multi",n=e(t.data("locale"));t.append("<div class='_week-picker'><input placeholder='"+("single"==c?n.OPEN_PICKER_SINGLE:n.OPEN_PICKER)+"' /><div class='_middle'><div class='_popup' style='display:none'><div class='_oh'><a href='javascript:void(0)' class='_arrow _left'>&lt;</a><p class='_yeardisp' /><a href='javascript:void(0)' class='_arrow _right'>&gt;</a></div><table class='_weekTable' /><div class='_uh'><a class='_clear' href='javascript:void(0)'>"+n.CLEAR+"</a></div></div></div></div>");var s=t.find("._popup");t.weekPicker("changeYear",(new Date).getFullYear()),t.find("input").on("change input",function(e){e.target.value=""}),t.children("div").on("click","td",function(){if("single"==c){var e=i(this).hasClass("_active");t.find("._active").toggleClass("_active"),e||i(this).toggleClass("_active")}else i(this).toggleClass("_active");t.weekPicker("toggleWeek",i(this).data("week"),t.data("year"))}),t.find("._clear").on("click",function(){r.weekPicker.chosen=[],t.weekPicker("updateSelection")}),"single"!=this.weekPicker.mode&&(t.children("div").on("mousedown touchstart","td",function(){var e=i(this).data("week"),c=t.data("year");r.weekPicker.rangestart=a().year(c).isoWeek(e).startOf("isoWeek"),r.weekPicker.rangestartActive=i(this).hasClass("_active")}),t.children("div").on("mouseup touchend","td",function(){if(r.weekPicker.rangestart){var e,c=i(this).data("week"),n=t.data("year"),s=a().year(n).isoWeek(c).startOf("isoWeek");if(r.weekPicker.rangestartActive)if((e=r.weekPicker.rangestart)<s)for(;e<=s;)t.weekPicker("removeDate",e.format("YYYY-MM-DD")),e.add(1,"week");else for(;s<=e;)t.weekPicker("removeDate",s.format("YYYY-MM-DD")),s.add(1,"week");else if((e=r.weekPicker.rangestart)<s)for(;e<=s;)t.weekPicker("addDate",e.format("YYYY-MM-DD")),e.add(1,"week");else for(;s<=e;)t.weekPicker("addDate",s.format("YYYY-MM-DD")),s.add(1,"week");t.weekPicker("updateSelection")}})),t.on("dragstart","td",function(){return!1}),t.find("._oh").on("click","._arrow",function(e){var a=i(e.target).hasClass("_right"),r=Number(t.data("year"));t.weekPicker("changeYear",r+(a?1:-1))}),t.children().children().on("click focus",function(e){e.stopPropagation(),s.show()}),i(document).on("click",function(){s.hide()})},clear:function(){this.weekPicker.chosen=[],i(this).weekPicker("updateSelection")},value:function(){return this.weekPicker.chosen},addDate:function(e){-1===this.weekPicker.chosen.indexOf(e)&&this.weekPicker.chosen.push(e)},removeDate:function(e){var i=this.weekPicker.chosen.indexOf(e);-1!==i&&this.weekPicker.chosen.splice(i,1)},toggleWeek:function(e,i){var t=a().year(i).isoWeek(e).startOf("isoWeek").format("YYYY-MM-DD"),r=this.weekPicker.chosen.indexOf(t);-1!==r?this.weekPicker.chosen.splice(r,1):"single"==this.weekPicker.mode?this.weekPicker.chosen=[t]:this.weekPicker.chosen.push(t)},updateSelection:function(){var t=i(this),r=t.find("table");r.empty();var c=t.data("year"),n=a().year(c).isoWeeksInYear();t.find("._yeardisp").text(c);for(var s,o=1;o<n+1;o++){o%7==1&&(r.append("<tr />"),s=r.find("tr").last());var k=-1!==this.weekPicker.chosen.indexOf(a().year(c).isoWeek(o).startOf("isoWeek").format("YYYY-MM-DD")),d=c==(new Date).getFullYear()&&o==a().isoWeek();s.append("<td class='"+(k?"_active ":"")+(d?"_current":"")+"' data-week='"+o+"'><a href='javascript:void(0)'>"+o+"</a></td>")}var l=e(t.data("locale")),h=t.find("input");0!==this.weekPicker.chosen.length?"single"==this.weekPicker.mode?h.val(l.WEEK_SELECTED.replace("$weeknum",this.weekPicker.chosen[0].isoWeek())):h.val(l.NUM_SELECTED.replace("$num_selected",this.weekPicker.chosen.length)):h.val("")},changeYear:function(e){if(!e)throw new Error("need year");"string"==typeof e&&(e=Number(e));var a=i(this);a.data("year",e),a.weekPicker("updateSelection")}};return this.each(function(){this.weekPicker||(this.weekPicker={chosen:[],disabled:[]}),n[t]&&(r=n[t].apply(this,Array.prototype.slice.call(c,1)))}),r},i(document).ready(function(){i(".week-picker").weekPicker("init")})}();