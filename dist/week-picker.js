!function(){if(!window.moment)throw new Error("moment.js not found; required");if(!window.jQuery)throw new Error("jQuery not found; required");var e=window.jQuery,i=window.moment;e.fn.weekPicker=function(a){var t=this,r=arguments,n={init:function(){var a=e(this),t=this;a.empty();var r,n=this.weekPicker.mode=a.data("mode")||"multi";switch(a.data("locale")){case"sv":r={OPEN_PICKER:"single"==n?"Välj vecka...":"Välj veckor...",CLEAR:"Rensa"};break;default:r={OPEN_PICKER:"single"==n?"Choose a week...":"Open picker...",CLEAR:"Clear"}}a.append("<div class='_week-picker'><input placeholder='"+r.OPEN_PICKER+"' /><div class='_middle'><div class='_popup' style='display:none'><div class='_oh'><a href='javascript:void(0)' class='_arrow _left'>&lt;</a><p class='_yeardisp' /><a href='javascript:void(0)' class='_arrow _right'>&gt;</a></div><table class='_weekTable' /><div class='_uh'><a class='_clear' href='javascript:void(0)'>"+r.CLEAR+"</a></div></div></div></div>");var c=a.find("._popup");a.weekPicker("changeYear",(new Date).getFullYear()),a.find("input").on("change input",function(e){e.target.value=""}),a.children("div").on("click","td",function(){if("single"==n){var i=e(this).hasClass("_active");a.find("._active").toggleClass("_active"),i||e(this).toggleClass("_active")}else e(this).toggleClass("_active");a.weekPicker("toggleWeek",e(this).data("week"),a.data("year"))}),a.find("._clear").on("click",function(){t.weekPicker.chosen=[],a.weekPicker("updateSelection")}),"single"!=this.weekPicker.mode&&(a.children("div").on("mousedown touchstart","td",function(){var r=e(this).data("week"),n=a.data("year");t.weekPicker.rangestart=i().year(n).isoWeek(r).startOf("isoWeek"),t.weekPicker.rangestartActive=e(this).hasClass("_active")}),a.children("div").on("mouseup touchend","td",function(){if(t.weekPicker.rangestart){var r,n=e(this).data("week"),c=a.data("year"),s=i().year(c).isoWeek(n).startOf("isoWeek");if(t.weekPicker.rangestartActive)if((r=t.weekPicker.rangestart)<s)for(;r<=s;)a.weekPicker("removeDate",r.format("YYYY-MM-DD")),r.add(1,"week");else for(;s<=r;)a.weekPicker("removeDate",s.format("YYYY-MM-DD")),s.add(1,"week");else if((r=t.weekPicker.rangestart)<s)for(;r<=s;)a.weekPicker("addDate",r.format("YYYY-MM-DD")),r.add(1,"week");else for(;s<=r;)a.weekPicker("addDate",s.format("YYYY-MM-DD")),s.add(1,"week");a.weekPicker("updateSelection")}})),a.on("dragstart","td",function(){return!1}),a.find("._oh").on("click","._arrow",function(i){var t=e(i.target).hasClass("_right"),r=Number(a.data("year"));a.weekPicker("changeYear",r+(t?1:-1))}),a.children().children().on("click focus",function(e){e.stopPropagation(),c.show()}),e(document).on("click",function(){c.hide()})},clear:function(){this.weekPicker.chosen=[],e(this).weekPicker("updateSelection")},value:function(){return this.weekPicker.chosen},addDate:function(e){-1===this.weekPicker.chosen.indexOf(e)&&this.weekPicker.chosen.push(e)},removeDate:function(e){var i=this.weekPicker.chosen.indexOf(e);-1!==i&&this.weekPicker.chosen.splice(i,1)},toggleWeek:function(e,a){var t=i().year(a).isoWeek(e).startOf("isoWeek").format("YYYY-MM-DD"),r=this.weekPicker.chosen.indexOf(t);-1!==r?this.weekPicker.chosen.splice(r,1):"single"==this.weekPicker.mode?this.weekPicker.chosen=[t]:this.weekPicker.chosen.push(t)},updateSelection:function(){var a=e(this),t=a.find("table");t.empty();var r=a.data("year"),n=i().year(r).isoWeeksInYear();a.find("._yeardisp").text(r);for(var c,s=1;s<n+1;s++){s%7==1&&(t.append("<tr />"),c=t.find("tr").last());var o=-1!==this.weekPicker.chosen.indexOf(i().year(r).isoWeek(s).startOf("isoWeek").format("YYYY-MM-DD")),k=r==(new Date).getFullYear()&&s==i().isoWeek();c.append("<td class='"+(o?"_active ":"")+(k?"_current":"")+"' data-week='"+s+"'><a href='javascript:void(0)'>"+s+"</a></td>")}},changeYear:function(i){if(!i)throw new Error("need year");"string"==typeof i&&(i=Number(i));var a=e(this);a.data("year",i),a.weekPicker("updateSelection")}};return this.each(function(){this.weekPicker||(this.weekPicker={chosen:[],disabled:[]}),n[a]&&(t=n[a].apply(this,Array.prototype.slice.call(r,1)))}),t},e(document).ready(function(){e(".week-picker").weekPicker("init")})}();