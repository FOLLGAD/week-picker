!function(){var e=function(e){var t;switch(e){case"sv":case"se":t={OPEN_PICKER_SINGLE:"Välj vecka...",OPEN_PICKER:"Välj veckor...",CLEAR:"Rensa",NUM_SELECTED:"$num_selected veckor valda",WEEK_SELECTED:"Vecka $weeknum, $year"};break;case"en":default:t={OPEN_PICKER_SINGLE:"Choose a week...",OPEN_PICKER:"Open picker...",CLEAR:"Clear",NUM_SELECTED:"$num_selected weeks selected",WEEK_SELECTED:"Week $weeknum, $year"}}return t};if(!window.moment)throw new Error("moment.js not found; please place it in the global scope.");if(!window.jQuery&&!window.$)throw new Error("jQuery not found; please place it in the global scope.");var t=window.jQuery||window.$,i=window.moment;t.fn.weekPicker=function(a){var r=this,n=arguments,c={init:function(){var a=t(this),r=this;a.empty();var n=this.weekPicker.mode=a.data("mode")||"multi",c=e(a.data("locale"));a.append("<div class='_week-picker'><input placeholder='"+("single"==n?c.OPEN_PICKER_SINGLE:c.OPEN_PICKER)+"' /><div class='_middle'><div class='_popup' style='display:none'><div class='_oh'><a href='javascript:void(0)' class='_arrow _left'>&lt;</a><p class='_yeardisp' /><a href='javascript:void(0)' class='_arrow _right'>&gt;</a></div><table class='_weekTable' /><div class='_uh'><a class='_clear' href='javascript:void(0)'>"+c.CLEAR+"</a></div></div></div></div>");var o=a.find("._popup");if(a.weekPicker("changeYear",(new Date).getFullYear()),a.find("input").on("change input",function(e){e.target.value=""}),a.children("div").on("click","td",function(){a.weekPicker("toggleWeek",t(this).data("week"),a.data("year"))}),a.find("._clear").on("click",function(){r.weekPicker.chosen=[],a.weekPicker("updateSelection")}),"single"!=this.weekPicker.mode){var s=a.children("div"),k=!1;s.on("mousedown","td",function(e){k=!0;var n=t(this).data("week"),c=a.data("year");r.weekPicker.rangestart=i().year(c).isoWeek(n).startOf("isoWeek"),r.weekPicker.rangeIsAdding=t(this).hasClass("_active")}),s.on("mousemove","td",function(e){var n=t(this).data("week"),c=a.data("year");r.weekPicker.rangeend=i().year(c).isoWeek(n).startOf("isoWeek")}),s.on("mouseup","td",function(e){if(r.weekPicker.rangestart){var n=t(this).data("week"),c=a.data("year"),o=r.weekPicker.rangestart,s=i().year(c).isoWeek(n).startOf("isoWeek"),k=r.weekPicker.rangeIsAdding?"addDate":"removeDate";if(o<s)for(;o<=s;)a.weekPicker(k,o.format("YYYY-MM-DD")),o.add(1,"week");else for(;s<=o;)a.weekPicker(k,s.format("YYYY-MM-DD")),s.add(1,"week");a.weekPicker("updateSelection")}}),s.on("touchstart","td",function(e){k=!0;var n=t(this).data("week"),c=a.data("year");r.weekPicker.rangestart=i().year(c).isoWeek(n).startOf("isoWeek"),r.weekPicker.rangeIsAdding=t(this).hasClass("_active")}),s.on("touchmove","td",function(e){var t=e.originalEvent.changedTouches[0];document.elementFromPoint(t.clientX,t.clientY)}),s.on("touchend","td",function(e){k=!1;var t=e.originalEvent.changedTouches[0],i=document.elementFromPoint(t.clientX,t.clientY);console.log(i)})}a.on("dragstart","td",function(){return!1}),a.find("._oh").on("click","._arrow",function(e){var i=t(e.target).hasClass("_right"),r=Number(a.data("year"));a.weekPicker("changeYear",r+(i?1:-1))}),a.children().children().on("click focus",function(e){o.show()}),t(document).on("click",function(e){var t=a.children().children();0!==t.find(e.target).length||t.is(e.target)||o.hide()}),a.on("keypress",function(e){"Enter"==e.code&&e.target})},clear:function(){this.weekPicker.chosen=[],t(this).weekPicker("updateSelection")},value:function(){return this.weekPicker.chosen},addDate:function(e){-1===this.weekPicker.chosen.indexOf(e)&&this.weekPicker.chosen.push(e)},setRange:function(e,t,i){var a=headthis.weekPicker.rangestart;if(a<stop)for(;a<=stop;)$this.weekPicker("removeDate",a.format("YYYY-MM-DD")),a.add(1,"week");else for(;stop<=a;)$this.weekPicker("removeDate",stop.format("YYYY-MM-DD")),stop.add(1,"week")},removeDate:function(e){var t=this.weekPicker.chosen.indexOf(e);-1!==t&&this.weekPicker.chosen.splice(t,1)},toggleWeek:function(e,a){var r=i().year(a).isoWeek(e).startOf("isoWeek").format("YYYY-MM-DD"),n=this.weekPicker.chosen.indexOf(r);-1!==n?this.weekPicker.chosen.splice(n,1):"single"==this.weekPicker.mode?this.weekPicker.chosen=[r]:this.weekPicker.chosen.push(r),t(this).weekPicker("updateInputVal")},updateSelection:function(){var e=t(this),a=e.find("table");a.empty();var r=e.data("year"),n=i().year(r).isoWeeksInYear();e.find("._yeardisp").text(r);for(var c,o=1;o<n+1;o++){o%7==1&&(a.append("<tr />"),c=a.find("tr").last());var s=-1!==this.weekPicker.chosen.indexOf(i().year(r).isoWeek(o).startOf("isoWeek").format("YYYY-MM-DD")),k=r==(new Date).getFullYear()&&o==i().isoWeek();c.append("<td class='"+(s?"_active ":"")+(k?"_current":"")+"' data-week='"+o+"'>"+o+"</td>")}e.weekPicker("updateInputVal")},changeYear:function(e){if(!e)throw new Error("need year");"string"==typeof e&&(e=Number(e));var i=t(this);i.data("year",e),i.weekPicker("updateSelection")},updateInputVal:function(){var a=t(this),r=e(a.data("locale")),n=a.find("input");if(0!==this.weekPicker.chosen.length)if("single"==this.weekPicker.mode){var c=i(this.weekPicker.chosen[0]);n.val(r.WEEK_SELECTED.replace("$weeknum",c.isoWeek()).replace("$year",c.year()))}else n.val(r.NUM_SELECTED.replace("$num_selected",this.weekPicker.chosen.length));else n.val("")}};return this.each(function(){this.weekPicker||(this.weekPicker={chosen:[],disabled:[]}),c[a]&&(r=c[a].apply(this,Array.prototype.slice.call(n,1)))}),r},t(document).ready(function(){t(".week-picker").each(function(){t(this).weekPicker("init")})})}();